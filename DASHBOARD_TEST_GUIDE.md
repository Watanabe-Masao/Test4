# 📊 プロフェッショナルダッシュボード テストガイド

## ✅ 実装完了コンポーネント

### Phase 1: 基盤 (完了 ✅)
- [x] PivotEngine.js - ピボットテーブル計算エンジン
- [x] ChartBase.js - キャンバスベースのチャート基底クラス

### Phase 2: メインダッシュボード (完了 ✅)
- [x] DashboardApp.js - メインオーケストレーター
- [x] professionalDashboard.css - プロフェッショナルスタイル
- [x] main.js 統合
- [x] index.html 統合

---

## 🧪 テスト手順

### 1. 事前準備

#### 1.1 ブラウザを開く
```
file:///home/user/Test4/index.html
```

#### 1.2 開発者ツールを開く
- F12 キーを押す
- Console タブを選択
- エラーがないか確認

**期待される出力:**
```
🚀 Initializing 仕入粗利管理システム v8 (Refactored)
💾 Initializing database...
✅ Database initialized
🔄 Restoring data from IndexedDB...
✅ Application initialized successfully
```

### 2. データインポート

#### 2.1 仕入ファイルをインポート
1. 📦 仕入カードをクリック
2. Excelファイルを選択
3. インポートダイアログが表示される
4. **「インポート実行」をクリック** ← 重要！

**確認ポイント:**
- ✅ トースト通知: "仕入データ: [ファイル名]"
- ✅ Console: "✅ shiire data saved to IndexedDB"
- ✅ Console: "📊 Converted XXX records for shiire"

#### 2.2 売上・売変ファイルをインポート
1. 💰 売上・売変カードをクリック
2. Excelファイルを選択
3. インポートダイアログで **「インポート実行」をクリック**

**確認ポイント:**
- ✅ トースト通知: "売上・売変データ: [ファイル名]"
- ✅ Console: "✅ uriage data saved to IndexedDB"
- ✅ Console: "✅ baihen data saved to IndexedDB"

#### 2.3 初期設定ファイルをインポート (オプション)
1. ⚙️ 初期設定カードをクリック
2. Excelファイルを選択
3. インポートダイアログで **「インポート実行」をクリック**

**確認ポイント:**
- ✅ トースト通知: "初期設定: [ファイル名]"
- ✅ Console: "✅ settings data saved to IndexedDB"

#### 2.4 予算ファイルをインポート (オプション)
1. 📊 予算カードをクリック
2. Excelファイルを選択
3. インポートダイアログで **「インポート実行」をクリック**

### 3. ダッシュボード表示

#### 3.1 ダッシュボードを開く
1. **「📊 ダッシュボード表示」ボタンをクリック**
2. ローディング表示が出る
3. プロフェッショナルダッシュボードが表示される

**期待される表示:**
```
✅ Professional dashboard initialized successfully
```

#### 3.2 ダッシュボードコンポーネントの確認

**ヘッダー:**
- [x] タイトル: "📊 仕入・粗利・在庫管理ダッシュボード"
- [x] 日付範囲表示: "YYYY/MM/DD ~ YYYY/MM/DD"
- [x] 🔄 更新ボタン
- [x] 📥 エクスポートボタン
- [x] ⚙️ 設定ボタン

**KPIカードグリッド (8枚):**
1. [x] 💰 総売上 - 数値、単位(円)、トレンド(↗↘→)
2. [x] 💎 粗利額 - 数値、単位(円)、トレンド
3. [x] 📊 粗利率 - 数値、単位(%)、トレンド
4. [x] 📦 総仕入高 - 数値、単位(円)、トレンド
5. [x] 🏪 推定在庫 - 数値、単位(円)、トレンド
6. [x] 🎯 予算達成率 - 数値、単位(%)、トレンド
7. [x] 💸 売変率 - 数値、単位(%)
8. [x] 📅 日平均売上 - 数値、単位(円)

**ピボットテーブル:**
- [x] ヘッダー: "📊 店舗×日付別 仕入分析"
- [x] CSV出力ボタン
- [x] テーブル表示 (日付×店舗)
- [x] 総計列
- [x] スクロール可能

**チャート (3つ):**
1. [x] 📈 売上トレンド - 折れ線グラフ (売上・粗利)
2. [x] 📦 推定在庫推移 - エリアチャート
3. [x] 🎯 予算達成率 - リングプログレス

---

## 🎨 UI/UX チェック

### デザイン確認
- [x] ダークテーマ (背景: #0F172A)
- [x] カードの影とボーダー
- [x] KPIカードのカラーバリエーション (8色)
- [x] アニメーション (フェードイン)

### インタラクション確認
- [x] KPIカードホバーエフェクト (上に浮く)
- [x] ボタンホバーエフェクト
- [x] チャートホバーツールチップ
- [x] ピボットテーブル行ホバー

### レスポンシブ確認
- [x] デスクトップ表示 (1200px以上)
- [x] タブレット表示 (768px - 1200px)
- [x] モバイル表示 (480px - 768px)

---

## 🐛 トラブルシューティング

### エラー: "データがありません"

**原因:**
- IndexedDBにデータが保存されていない
- インポート時に「インポート実行」をクリックしていない

**解決方法:**
1. F12 → Application → IndexedDB → shiire_araki_db を確認
2. レコード数が0の場合、ファイルを再インポート
3. インポートダイアログで **必ず「インポート実行」をクリック**

### エラー: "Dashboard initialization failed"

**原因:**
- インポートミス
- JavaScriptエラー

**解決方法:**
1. Console タブでエラーメッセージを確認
2. ページをリロード (Ctrl+F5 でキャッシュクリア)
3. データを再インポート

### チャートが表示されない

**原因:**
- Canvas要素の初期化エラー
- データ不足

**解決方法:**
1. Console で "Failed to render" エラーを確認
2. ブラウザの互換性確認 (Chrome, Firefox, Edge推奨)
3. データが十分にあるか確認 (最低でも3日分のデータ)

### ピボットテーブルが空

**原因:**
- 仕入データがない
- 日付範囲外

**解決方法:**
1. 仕入ファイルを再インポート
2. データの日付範囲を確認
3. Console で "pivot data" のログを確認

---

## 📊 データ確認方法

### IndexedDB の確認
1. F12 → Application タブ
2. 左サイドバー → IndexedDB → shiire_araki_db
3. 各ストアのレコード数を確認:
   - shiire: 仕入データ
   - uriage: 売上データ
   - baihen: 売変データ
   - budget: 予算データ
   - settings: 初期設定

### 専用確認ページの使用
```
file:///home/user/Test4/check-db.html
```

**機能:**
- データベース接続確認
- 各ストアのレコード数表示
- サンプルデータ表示

---

## 🔧 高度なテスト

### Console コマンド

#### データベース情報を表示
```javascript
showDbInfo()
```

#### ダッシュボードを手動で初期化
```javascript
import('./js/ui/dashboard/DashboardApp.js').then(m => {
  const dashboard = new m.DashboardApp('content');
  dashboard.initialize();
});
```

#### ピボットテーブルをテスト
```javascript
import('./js/services/database/pivotEngine.js').then(m => {
  const testData = [
    { date: '1/1', store: '01', cost: 1000 },
    { date: '1/1', store: '02', cost: 1500 },
    { date: '1/2', store: '01', cost: 1200 }
  ];

  const pivot = m.createPivot(testData, {
    rows: ['date'],
    columns: ['store'],
    valueField: 'cost',
    aggFunc: 'sum'
  });

  console.log(pivot);
});
```

---

## ✅ 完了チェックリスト

### 基本機能
- [ ] データインポートが成功する
- [ ] ダッシュボードが表示される
- [ ] KPIカードに数値が表示される
- [ ] ピボットテーブルにデータが表示される
- [ ] チャートが描画される

### 計算の正確性
- [ ] 総売上 = 売上データの合計
- [ ] 粗利額 = 売上 - 原価
- [ ] 粗利率 = (粗利額 / 売上) × 100
- [ ] 予算達成率 = (実績 / 予算) × 100

### UI/UX
- [ ] ローディング表示が出る
- [ ] アニメーションがスムーズ
- [ ] ホバーエフェクトが動作する
- [ ] レスポンシブデザインが機能する

### パフォーマンス
- [ ] ダッシュボード表示 < 3秒
- [ ] チャート描画 < 1秒
- [ ] ピボットテーブル表示 < 2秒

---

## 📝 既知の制限事項

1. **エクスポート機能**: 現在は開発中（トースト通知のみ）
2. **日付範囲フィルター**: UI未実装（コードは準備済み）
3. **店舗フィルター**: UI未実装（コードは準備済み）
4. **詳細分析テーブル**: Phase 4 で実装予定

---

## 🚀 次の改善案

### Phase 3: フィルターとコントロール
- [ ] 日付範囲ピッカー UI
- [ ] 店舗マルチセレクト UI
- [ ] ビュー切り替えボタン

### Phase 4: 詳細分析
- [ ] 仕入先別分析テーブル
- [ ] カテゴリ別分析テーブル
- [ ] 店舗比較テーブル
- [ ] 日別詳細テーブル

### Phase 5: エクスポート
- [ ] CSV エクスポート実装
- [ ] Excel エクスポート実装
- [ ] PDF レポート生成

---

## 📞 サポート

問題が発生した場合:
1. Console のエラーログをコピー
2. スクリーンショットを撮影
3. 実行した手順を記録
4. データファイルの形式を確認

---

**更新日:** 2026-02-13
**バージョン:** Professional Dashboard v1.0.0
**ステータス:** ✅ Phase 1-2 完了、テスト準備完了
