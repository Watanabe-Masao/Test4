# 📊 データベース保存確認ガイド

## 🔍 データが保存されているか確認する方法

### 方法1: 専用確認ページで確認
1. ブラウザで `check-db.html` を開く
   ```
   file:///home/user/Test4/check-db.html
   ```
2. 「データベースをチェック」ボタンをクリック
3. 各ストアのレコード数が表示される

### 方法2: ブラウザの開発者ツールで確認
1. F12 キーを押して開発者ツールを開く
2. 「Application」タブを選択（Chromeの場合）
3. 左サイドバーの「IndexedDB」を展開
4. `shiire_araki_db` を探す
5. 各ストア（shiire, uriage など）のレコード数を確認

---

## ⚠️ 重要: インポート確認ダイアログ

### ファイル読込時の動作

Excelファイルを読み込むと、**自動的にインポート確認ダイアログが表示されます**。

#### ダイアログの内容:
```
┌─────────────────────────────────────┐
│ 📥 データインポート            [×] │
├─────────────────────────────────────┤
│                                     │
│ データタイプ: 仕入データ            │
│ レコード数: 1,234件                 │
│                                     │
│ 📊 差分サマリー                     │
│ ➕ 新規追加: 1,234                  │
│ 🔄 更新: 0                          │
│ ✓ 変更なし: 0                       │
│                                     │
│ 📋 マージモード                     │
│ ○ 🤖 スマートマージ (推奨)         │
│ ○ 🔄 完全置換                      │
│ ○ ➕ 追加のみ                      │
│ ○ ⏭️ スキップ                     │
│                                     │
│ 👁️ データプレビュー (先頭10件)    │
│ [テーブル表示]                      │
│                                     │
├─────────────────────────────────────┤
│         [キャンセル] [インポート実行]│
└─────────────────────────────────────┘
```

### ✅ データを保存する手順

1. **ファイルを読み込む**
   - 📦 仕入、💰 売上・売変 などのカードをクリック
   - Excelファイルを選択

2. **ダイアログが表示される**
   - データ内容を確認
   - マージモードを選択（通常は「スマートマージ」のまま）

3. **「インポート実行」ボタンをクリック** ← ここが重要！
   - クリックしないとDBに保存されません
   - 進捗バーが表示され、完了すると自動的に閉じる

4. **確認**
   - `check-db.html` でレコード数を確認

---

## 🚫 データが保存されない原因

### 原因1: ダイアログを閉じてしまった
- [×]ボタンや「キャンセル」をクリックするとデータは保存されない
- **解決策**: ファイルを再度読み込んで「インポート実行」をクリック

### 原因2: ダイアログが表示されていない
- JavaScript エラーが発生している可能性
- **確認方法**: F12 → Console タブでエラーを確認

### 原因3: ブラウザがIndexedDBをサポートしていない
- 古いブラウザでは動作しない
- **解決策**: Chrome、Firefox、Edge の最新版を使用

---

## 🔧 トラブルシューティング

### エラーログを確認する

1. F12 キーで開発者ツールを開く
2. Console タブを選択
3. ファイルを読み込む
4. 以下のようなログが表示されるはずです:

```
✅ shiire data saved to IndexedDB
📊 Converted 1234 records for shiire
✅ Imported 1234 records (shiire)
```

### ダイアログが表示されない場合

Console で以下のコマンドを実行してダイアログを手動テスト:

```javascript
// テストダイアログを表示
import('./js/ui/importDialog.js').then(module => {
  const testData = [
    { date: Date.now(), store: '1', cost: 1000 }
  ];

  module.importDialog.show(
    'shiire',
    testData,
    (mode) => console.log('Confirmed with mode:', mode),
    () => console.log('Cancelled')
  );
});
```

---

## 📝 マージモードの説明

| モード | 説明 | 用途 |
|--------|------|------|
| 🤖 スマートマージ (推奨) | 重複を自動検出して更新 | 通常はこれを使用 |
| 🔄 完全置換 | 既存データを削除して新規追加 | データを完全にリセットしたい場合 |
| ➕ 追加のみ | 既存データを保持して追加 | データを蓄積したい場合 |
| ⏭️ スキップ | 重複をスキップ、新規のみ追加 | 新しいデータのみ追加したい場合 |

---

## 📊 データが正常に保存された例

### check-db.html の表示:
```
📊 データベース情報
✅ データベース "shiire_araki_db" (バージョン: 1) に接続しました

📁 shiire
   レコード数: 1,234

📁 uriage
   レコード数: 456

📁 baihen
   レコード数: 456

合計: 3/14 ストアにデータあり
総レコード数: 2,146
```

これが表示されれば、データは正常に保存されています！

---

## 💡 ヒント

- **データを確実に保存するには**: ダイアログの「インポート実行」を必ずクリック
- **複数ファイルの読込**: 各ファイルごとにダイアログが表示されます
- **データの上書き**: 同じファイルを再度読み込むと、マージモードに応じて処理されます
- **データのクリア**: デバッグパネル（🛠️ボタン）から全データを削除できます
